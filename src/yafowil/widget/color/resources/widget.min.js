!function(e,t,s){"use strict";class i{static initialize(e){t("input.color-picker",e).each((function(){new i(t(this),{hsl_display:!0,hex_display:!0})}))}constructor(e,i){this.picker=null,this.picker_elem=null,this.elem=e,this.elem.data("color_widget",this),this.elem.attr("spellcheck","false"),this.elem.attr("maxlength",7);let l=this.picker_elem=t('\n            <div class="color-picker-wrapper" />\n        ');if(i&&i.preview_elem)this.preview_elem=i.preview_elem,this.elem.after(l);else{let e=this.preview_elem=t('\n                <span class="color-picker-color" />\n            ');this.elem.after(e),this.preview_elem.after(l)}let h=this.close_btn=t('\n            <button class="close-button">âœ•</button>\n        ');if(this.picker_elem.append(h),this.color="#ffffff",this.color_swatches=[],this.elem.val(this.color),this.preview_elem.css("background",this.color),t(window).width()<=450){let e=this.picker_elem.outerWidth()/2-40;this.picker=new s.ColorPicker(l.get(0),{color:this.color,layoutDirection:"horizontal",width:e,layout:[{component:s.ui.Box,options:{}},{component:s.ui.Slider,options:{sliderType:"hue"}}]})}else this.picker=new s.ColorPicker(l.get(0),{color:this.color,layout:[{component:s.ui.Box,options:{}},{component:s.ui.Slider,options:{sliderType:"hue"}}]});let o=this.add_color_btn=t('\n            <button class="add_color">\n              + Add\n            </button>\n        '),c=this.remove_color_btn=t('\n            <button class="remove_color">\n              - Remove\n            </button>\n        '),r=t('<div class="buttons"/>');this.picker_elem.append(r),r.append(o).append(c),this.create_swatch=this.create_swatch.bind(this),this.remove_swatch=this.remove_swatch.bind(this),this.add_color_btn.on("click",this.create_swatch),this.remove_color_btn.on("click",this.remove_swatch);let a=this.swatches_container=t('\n            <div class="color-picker-recent"></div>\n        ');this.picker_elem.append(a),i&&this.init_options(i),this.elem.offset().top+this.elem.height()+this.picker_elem.height()>t(document).height()-44&&this.picker_elem.css("transform","translateY(calc(-100% - 28px)"),this.trigger_handle=this.trigger_handle.bind(this),this.elem.on("focus",this.trigger_handle),this.elem.on("input",(()=>{let e=this.elem.val();0===e.length&&this.elem.val("#"),this.update_hex_value(e)})),this.preview_elem.on("click",this.trigger_handle),this.update_color=this.update_color.bind(this),this.picker.on("color:change",this.update_color),this.hide_elem=this.hide_elem.bind(this),this.close_btn.on("click",this.hide_elem),this.handle_keypress=this.handle_keypress.bind(this),this.handle_click=this.handle_click.bind(this),this.init_swatches()}init_options(e){if(e.hsl_display){let e=this.picker.color.hsl,s=this.hsl_display=t(`\n                <div class="hsl-display">\n                  <div>\n                    H:\n                    <input class="h" type="number" value="${e.h}"\n                        min="0", max="360" />\n                  </div>\n                  <div>\n                    S:\n                    <input class="s" type="number" value="${e.s}"\n                        min="0", max="100" />\n                  </div>\n                  <div>\n                    L:\n                    <input class="l" type="number" value="${e.l}"\n                        min="0", max="100" />\n                  </div>\n                </div>\n            `);this.picker_elem.append(s),t("input",this.hsl_display).on("input",this.update_hsl_value.bind(this))}if(e.hex_display){let e=this.hex_display=t(`\n                <div class="hex-display">\n                  HEX:\n                  <input value="${this.picker.color.hexString}"\n                    spellcheck="false" maxlength="7" />\n                </div>\n            `);this.picker_elem.append(e);let s=this.picker.color.hexString;this.hex_display.val(s),t("input",this.hex_display).on("input",(e=>{let s=t(e.currentTarget).val();0===s.length&&t(e.currentTarget).val("#"),this.update_hex_value(s)}))}}init_swatches(){let e=localStorage.getItem("color-swatches");if(e){this.swatches_container.show(),this.color_swatches=JSON.parse(e);for(let e of this.color_swatches){let s=e.hex.substr(1),i=t(`\n                    <div class="color-swatch"\n                         id="${s}"\n                         style="background:${e.hex}"/>\n                `);this.swatches_container.append(i),i.on("click",(()=>{this.color=e.hex,this.picker.color.hsl=e.hsl,t("div.color-swatch").length>1&&t("div.color-swatch").removeClass("selected"),i.addClass("selected")}))}}}update_color(){let e=this.picker.color.hexString,s=this.picker.color.hsl;this.preview_elem.css("background",e),this.elem.val(e),this.hsl_display&&(t("input.h",this.hsl_display).val(s.h),t("input.s",this.hsl_display).val(s.s),t("input.l",this.hsl_display).val(s.l)),this.hex_display&&t("input",this.hex_display).val(e)}update_hsl_value(e){e.preventDefault();let s=t(e.target),i={h:this.picker.color.hsl.h,s:this.picker.color.hsl.s,l:this.picker.color.hsl.l};switch(s.attr("class")){case"h":i.h=s.val();break;case"s":i.s=s.val();break;case"l":i.l=s.val()}this.picker.color.hsl=i}update_hex_value(e){"string"!=typeof e||"#"!==e[0]||7!==e.length||isNaN(Number("0x"+e.substring(1,7)))||(this.picker.color.hexString=e)}trigger_handle(e){"none"===this.picker_elem.css("display")?(this.picker_elem.show(),t(window).on("keydown",this.handle_keypress),t(window).on("mousedown",this.handle_click)):this.hide_elem()}handle_keypress(e){"Enter"===e.key||"Escape"===e.key?(e.preventDefault(),this.hide_elem()):"Delete"===e.key&&(e.preventDefault(),this.remove_swatch())}handle_click(e){let t=this.picker_elem;t.is(e.target)||0!==t.has(e.target).length||this.preview_elem.is(e.target)||"block"!==t.css("display")||this.hide_elem()}hide_elem(e){e&&e.preventDefault(),this.picker_elem.hide(),this.elem.blur(),t(window).off("keydown",this.handle_keypress),t(window).off("mousedown",this.handle_click)}create_swatch(e){e&&(e.preventDefault(),this.swatches_container.show());let s=this.picker.color.hsl,i=this.picker.color.hexString;for(let e of this.color_swatches)if(s.h===e.hsl.h&&s.s===e.hsl.s&&s.l===e.hsl.l)return;let l=t(`\n            <div class="color-swatch" id="${i}" style="background:${i}"/>\n        `);this.color_swatches.length>=12&&(this.color_swatches.shift(),t("div.color-swatch")[0].remove()),this.swatches_container.append(l),t("div.color-swatch").removeClass("selected"),l.addClass("selected");let h={hex:i,hsl:s};this.color_swatches.push(h),l.on("click",(()=>{this.color=i,this.picker.color.hsl=s,t("div.color-swatch").removeClass("selected"),l.addClass("selected")})),this.set_swatches()}remove_swatch(e){e&&e.preventDefault();let s=t("div.color-swatch.selected"),i=s.attr("id"),l=this.color_swatches;for(let e in l)i===l[e].hex&&this.color_swatches.splice(e,1);s.remove(),t("div.color-swatch").last().addClass("selected");let h=this.color_swatches[this.color_swatches.length-1];this.picker.color.hsl=h.hsl,this.set_swatches()}set_swatches(){let e=JSON.stringify(this.color_swatches);localStorage.setItem("color-swatches",e)}}t((function(){void 0!==window.ts?ts.ajax.register(i.initialize,!0):i.initialize()})),e.ColorWidget=i,Object.defineProperty(e,"__esModule",{value:!0}),void 0===window.yafowil&&(window.yafowil={}),window.yafowil.color=e}({},jQuery,iro);
//# sourceMappingURL=widget.min.js.map
