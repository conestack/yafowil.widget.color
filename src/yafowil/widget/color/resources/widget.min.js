!function(e,s,t){"use strict";class i{static initialize(e){s("input.color-picker",e).each((function(){let e={preview_elem:s("h1.title"),hsl_display:!0,hex_display:!0};new i(s(this),e)}))}constructor(e,i){this.picker=null,this.picker_elem=null,this.elem=e,this.elem.attr("spellcheck","false"),this.elem.attr("maxlength",7);let l=this.picker_elem=s('\n            <div class="color-picker-wrapper" />\n        ');if(i)if(i.preview_elem)this.preview_elem=i.preview_elem,this.elem.after(l);else{let e=this.preview_elem=s('\n                    <span class="color-picker-color" />\n                ');this.elem.after(e),this.preview_elem.after(l)}let h=this.close_btn=s('\n            <button class="close-button">âœ•</button>\n        ');this.picker_elem.append(h),this.color="#ffffff",this.color_swatches=[],this.elem.val(this.color),this.preview_elem.css("background",this.color),this.picker=new t.ColorPicker(l.get(0),{color:this.color,layout:[{component:t.ui.Box,options:{}},{component:t.ui.Slider,options:{sliderType:"hue"}}]});let o=this.add_color_btn=s('\n            <button class="add_color">\n              + Add\n            </button>\n        '),c=this.remove_color_btn=s('\n            <button class="remove_color">\n              - Remove\n            </button>\n        '),a=s('<div class="buttons"/>');this.picker_elem.append(a),a.append(o).append(c),this.create_swatch=this.create_swatch.bind(this),this.remove_swatch=this.remove_swatch.bind(this),this.add_color_btn.on("click",this.create_swatch),this.remove_color_btn.on("click",this.remove_swatch);let n=this.swatches_container=s('\n            <div class="color-picker-recent"></div>\n        ');this.picker_elem.append(n),i&&this.init_options(i),this.trigger_handle=this.trigger_handle.bind(this),this.elem.on("focus",this.trigger_handle),this.elem.on("input",(()=>{let e=this.elem.val();0===e.length&&this.elem.val("#"),this.update_hex_value(e)})),this.preview_elem.on("click",this.trigger_handle),this.update_color=this.update_color.bind(this),this.picker.on("color:change",this.update_color),this.hide_elem=this.hide_elem.bind(this),this.close_btn.on("click",this.hide_elem),this.handle_keypress=this.handle_keypress.bind(this),this.handle_click=this.handle_click.bind(this),this.init_swatches()}init_options(e){if(e.hsl_display){let e=this.picker.color.hsl,t=this.hsl_display=s(`\n                <div class="hsl-display">\n                  <div>\n                    h:\n                    <input class="h" type="number" value="${e.h}"\n                        min="0", max="360" />\n                  </div>\n                  <div>\n                    s:\n                    <input class="s" type="number" value="${e.s}"\n                        min="0", max="100" />\n                  </div>\n                  <div>\n                    l:\n                    <input class="l" type="number" value="${e.l}"\n                        min="0", max="100" />\n                  </div>\n                </div>\n            `);this.picker_elem.append(t),s("input",this.hsl_display).on("input",this.update_hsl_value.bind(this))}if(e.hex_display){let e=this.hex_display=s(`\n                <div class="hex-display">\n                  hex:\n                  <input value="${this.picker.color.hexString}"\n                    spellcheck="false" maxlength="7" />\n                </div>\n            `);this.picker_elem.append(e);let t=this.picker.color.hexString;this.hex_display.val(t),s("input",this.hex_display).on("input",(e=>{let t=s(e.currentTarget).val();0===t.length&&s(e.currentTarget).val("#"),this.update_hex_value(t)}))}}init_swatches(){let e=localStorage.getItem("color-swatches");if(e){this.swatches_container.show(),this.color_swatches=JSON.parse(e);for(let e of this.color_swatches){let t=s(`\n                    <div class="color-swatch"\n                         id="${e.hex}"\n                         style="background:${e.hex}"/>\n                `);this.swatches_container.append(t),t.on("click",(()=>{this.color=e.color,this.picker.color.hsl=e.hsl,s("div.color-swatch").length>1&&s("div.color-swatch").removeClass("selected"),t.addClass("selected")}))}}}update_color(){let e=this.picker.color.hexString,t=this.picker.color.hsl;this.preview_elem.css("background",e),this.elem.val(e),this.hsl_display&&(s("input.h",this.hsl_display).val(t.h),s("input.s",this.hsl_display).val(t.s),s("input.l",this.hsl_display).val(t.l)),this.hex_display&&s("input",this.hex_display).val(e)}update_hsl_value(e){e.preventDefault();let t=s(e.target),i={h:this.picker.color.hsl.h,s:this.picker.color.hsl.s,l:this.picker.color.hsl.l};switch(t.attr("class")){case"h":i.h=t.val();break;case"s":i.s=t.val();break;case"l":i.l=t.val()}this.picker.color.hsl=i}update_hex_value(e){"string"!=typeof e||"#"!==e[0]||7!==e.length||isNaN(Number("0x"+e.substring(1,7)))||(this.picker.color.hexString=e)}trigger_handle(e){e.preventDefault(),"none"===this.picker_elem.css("display")?(this.picker_elem.show(),s(window).on("keydown",this.handle_keypress),s(window).on("mousedown",this.handle_click)):this.hide_elem()}handle_keypress(e){"Enter"===e.key||"Escape"===e.key?(e.preventDefault(),this.hide_elem()):"Delete"===e.key&&(e.preventDefault(),this.remove_swatch())}handle_click(e){let s=this.picker_elem;s.is(e.target)||0!==s.has(e.target).length||this.preview_elem.is(e.target)||"block"!==s.css("display")||this.hide_elem()}hide_elem(e){e&&e.preventDefault(),this.picker_elem.hide(),this.elem.blur(),s(window).off("keydown",this.handle_keypress),s(window).off("mousedown",this.handle_click)}create_swatch(e){e&&(e.preventDefault(),this.swatches_container.show());let t=this.picker.color.hsl,i=this.picker.color.hexString;for(let e of this.color_swatches)if(t.h===e.hsl.h&&t.s===e.hsl.s&&t.l===e.hsl.l)return;let l=s(`\n            <div class="color-swatch" id="${i}" style="background:${i}"/>\n        `);this.color_swatches.length>=12&&(this.color_swatches.shift(),s("div.color-swatch")[0].remove()),this.swatches_container.append(l),s("div.color-swatch").removeClass("selected"),l.addClass("selected");let h={hex:i,hsl:t};this.color_swatches.push(h),l.on("click",(()=>{this.color=i,this.picker.color.hsl=t,s("div.color-swatch").removeClass("selected"),l.addClass("selected")})),this.set_swatches()}remove_swatch(e){e&&e.preventDefault();let t=s("div.color-swatch.selected"),i=t.attr("id"),l=this.color_swatches;for(let e in l)i===l[e].hex&&this.color_swatches.splice(e,1);t.remove(),s("div.color-swatch").last().addClass("selected");let h=this.color_swatches[this.color_swatches.length-1];this.picker.color.hsl=h.hsl,this.set_swatches()}set_swatches(){let e=JSON.stringify(this.color_swatches);localStorage.setItem("color-swatches",e)}}s((function(){void 0!==window.ts?ts.ajax.register(i.initialize,!0):i.initialize()})),e.ColorWidget=i,Object.defineProperty(e,"__esModule",{value:!0}),void 0===window.yafowil&&(window.yafowil={}),window.yafowil.color=e}({},jQuery,iro);
//# sourceMappingURL=widget.min.js.map
