var yafowil_color=function(t,i){"use strict";class s{constructor(t,i,s=!1){this.widget=t,this.color=i,this.fixed=s,this.elem=$("<div />").addClass("color-swatch").appendTo(this.widget.swatches_container),this.color_layer=$("<div />").addClass("swatch-color-layer").css("background-color",this.color.rgbaString).appendTo(this.elem),this.destroy=this.destroy.bind(this),this.select=this.select.bind(this),this.elem.on("click",this.select)}destroy(){this.elem.off("click",this.select),this.elem.remove()}select(t){$("div.color-swatch").removeClass("selected"),this.elem.addClass("selected"),this.widget.active_swatch=this,this.widget.picker.color.set(this.color)}}class e{constructor(t,i){this.widget=t,this.elem=$("<div />").addClass("hsl-display").appendTo(t.dropdown_elem);let s=$("<div />").addClass("hue").text("H:").appendTo(this.elem),e=$("<div />").addClass("saturation").text("S:").appendTo(this.elem),o=$("<div />").addClass("lightness").text("L:").appendTo(this.elem);this.hue_input=$("<input />").addClass("h").attr({type:"number",min:0,max:360}).val(i.h).appendTo(s),this.saturation_input=$("<input />").addClass("s").attr({type:"number",min:0,max:100}).val(i.s).appendTo(e),this.lightness_input=$("<input />").addClass("l").attr({type:"number",min:0,max:100}).val(i.l).appendTo(o),this.on_input=this.on_input.bind(this),this.hue_input.add(this.saturation_input).add(this.lightness_input).on("input",this.on_input)}get value(){return{h:parseInt(this.hue_input.val()),s:parseInt(this.saturation_input.val()),l:parseInt(this.lightness_input.val())}}set value(t){this.hue_input.val(t.h),this.saturation_input.val(t.s),this.lightness_input.val(t.l)}on_input(t){this.widget.picker.color.set(this.value)}}class o{constructor(t,i,s=!1){this.widget=t,this.elem=$("<div />").addClass("rgb-display").appendTo(t.dropdown_elem);let e=$("<div />").addClass("r").text("R:").appendTo(this.elem),o=$("<div />").addClass("g").text("G:").appendTo(this.elem),h=$("<div />").addClass("b").text("B:").appendTo(this.elem),l=$("<div />").addClass("a").text("A:").appendTo(this.elem);this.r_input=$("<input />").addClass("r").attr({type:"number",min:0,max:255}).val(i.r).appendTo(e),this.g_input=$("<input />").addClass("g").attr({type:"number",min:0,max:255}).val(i.g).appendTo(o),this.b_input=$("<input />").addClass("b").attr({type:"number",min:0,max:255}).val(i.b).appendTo(h),this.a_input=$("<input />").addClass("r").attr({type:"number",min:0,max:1}).val(i.a||1).appendTo(l),s||l.hide(),this.on_input=this.on_input.bind(this),this.r_input.add(this.g_input).add(this.b_input).add(this.a_input).on("input",this.on_input)}get rgb(){return{r:parseInt(this.r_input.val()),g:parseInt(this.g_input.val()),b:parseInt(this.b_input.val())}}get rgba(){return{r:parseInt(this.r_input.val()),g:parseInt(this.g_input.val()),b:parseInt(this.b_input.val()),a:parseFloat(this.a_input.val())}}set rgb(t){this.r_input.val(t.r),this.g_input.val(t.g),this.b_input.val(t.b)}set rgba(t){this.r_input.val(t.r),this.g_input.val(t.g),this.b_input.val(t.b),this.a_input.val(t.a)}on_input(t){this.a_input?this.widget.picker.color.set(this.rgba):this.widget.picker.color.set(this.rgb)}}class h{constructor(t,i){this.widget=t,this.elem=$("<div />").addClass("hex-display").text("HEX:").appendTo(t.dropdown_elem),this.input=$("<input />").val(i).attr({spellcheck:!1,maxlength:7}).appendTo(this.elem),this.on_input=this.on_input.bind(this),this.input.on("input",this.on_input)}get value(){return this.input.val()}set value(t){this.input.val(t)}on_input(){0===this.value.length?this.input.val("#"):this.widget.picker.color.set(this.value)}}class l{constructor(t,i){this.widget=t,this.elem=$("<div />").addClass("kelvin-display").text("K:").appendTo(t.dropdown_elem),this.input=$("<input readonly />").val(i).attr({type:"number"}).appendTo(this.elem),this.on_input=this.on_input.bind(this),this.input.on("input",this.on_input)}get value(){return this.input.val()}set value(t){this.input.val(parseFloat(t).toFixed(2))}on_input(){this.widget.picker.color.set(this.value)}}class a{static initialize(t){i("input.color-picker",t).each((function(t){let s=i(this),e={preview_elem:s.data("preview_elem"),format:s.data("format"),box_width:s.data("box_width"),box_height:s.data("box_height"),slider_size:s.data("slider_size"),color:s.data("color"),swatches:s.data("swatches")};new a(s,e,t)}))}constructor(t,s,e){this.elem=t,this.elem.data("color_widget",this).attr("spellcheck","false").attr("maxlength",7),this.dropdown_elem=i("<div />").addClass("color-picker-wrapper").css("top",this.elem.outerHeight()),this.picker_container=i("<div />").addClass("color-picker-container").appendTo(this.dropdown_elem),this.close_btn=i("<button />").addClass("close-button").text("âœ•").appendTo(this.dropdown_elem),this.add_color_btn=i("<button />").addClass("add_color").text("+ Add"),this.remove_color_btn=i("<button />").addClass("remove_color").text("- Remove"),this.buttons=i("<div />").addClass("buttons").append(this.add_color_btn).append(this.remove_color_btn).appendTo(this.dropdown_elem),this.swatches_container=i("<div />").addClass("color-picker-recent").appendTo(this.dropdown_elem),this.index=e;let o={color:s.color,width:s.box_width,layout:[{component:iro.ui.Box,options:{}},{component:iro.ui.Slider,options:{sliderType:"hue",sliderSize:s.slider_size}}]};s.format.includes("kelvin")&&o.layout.push({component:iro.ui.Slider,options:{sliderType:"kelvin",sliderSize:s.slider_size}}),s.format.includes("rgba")&&o.layout.push({component:iro.ui.Slider,options:{sliderType:"alpha",sliderSize:s.slider_size}}),s.box_height&&(o.boxHeight=s.box_height),this.picker=new iro.ColorPicker(this.picker_container.get(0),o),this.swatches=[],this.fixed_swatches=[],this.fix_swatches(s.swatches),this.parse_json(),this.init_options(s),this.color=this.picker.color.clone(),this.elem.val(this.color.hexString),this.preview_elem.css("background-color",this.color.rgbaString),this.on_resize=this.on_resize.bind(this),this.on_resize(),i(window).on("resize",this.on_resize),this.create_swatch=this.create_swatch.bind(this),this.add_color_btn.on("click",this.create_swatch),this.remove_swatch=this.remove_swatch.bind(this),this.remove_color_btn.on("click",this.remove_swatch),this.open=this.open.bind(this),this.elem.on("focus",this.open),this.preview_elem.on("click",this.open),this.elem.on("input",(()=>{let t=this.elem.val();0===t.length?this.elem.val("#"):this.picker.color.set(t)})),this.update_color=this.update_color.bind(this),this.picker.on("color:change",this.update_color),this.close=this.close.bind(this),this.close_btn.on("click",this.close),this.on_keydown=this.on_keydown.bind(this),this.on_click=this.on_click.bind(this)}parse_json(){let t=localStorage.getItem(`color-swatches-${this.index}`);if(t){let i=JSON.parse(t);this.swatches_container.show();for(let t of i)this.swatches.push(new s(this,new iro.Color(t)));this.swatches[this.swatches.length-1].select()}}init_options(t){if(t&&t.preview_elem){let s=i(t.preview_elem);this.elem.after(s),s.addClass("transparent").after(this.dropdown_elem),this.preview_elem=i("<div />").appendTo(s).addClass("preview-color-layer")}else{let t=i("<span />").addClass("color-picker-color");this.preview_elem=i("<div />").addClass("color-layer").appendTo(t),this.elem.after(t),t.after(this.dropdown_elem)}t.format.includes("hsl")?this.hsl_display=new e(this,this.picker.color.hsl):this.buttons.addClass("hsl-false"),t.format.includes("hex")&&(this.hex_display=new h(this,this.picker.color.hexString)),t.format.includes("kelvin")&&(this.kelvin_display=new l(this,this.picker.color.kelvin)),t.format.includes("rgba")?this.rgb_display=new o(this,this.picker.color.rgba,!0):t.format.includes("rgb")&&(this.rgb_display=new o(this,this.picker.color.rgb));let s={};t&&t.box_width&&(s.width=t.box_width),t&&t.box_height&&(s.height=t.box_height),this.box_dimensions=s}on_resize(t){if(i(window).width()<=450){this.dropdown_elem.hasClass("mobile")||(this.dropdown_elem.addClass("mobile"),this.picker.state.layoutDirection="horizontal"),this.box_dimensions.height&&(this.picker.state.boxHeight=null);let t=.3*i(window).width();this.picker.resize(t)}else i(window).width()>450&&this.dropdown_elem.hasClass("mobile")&&(this.dropdown_elem.removeClass("mobile"),this.picker.state.layoutDirection="vertical",this.box_dimensions.height&&(this.picker.state.boxHeight=this.box_dimensions.height),this.picker.resize(this.box_dimensions.width))}update_color(){this.color=this.picker.color.clone(),this.preview_elem.css("background-color",this.color.rgbaString),this.elem.val(this.color.hexString),this.hsl_display&&(this.hsl_display.value=this.color.hsl),this.rgb_display&&(this.rgb_display.a_input?this.rgb_display.rgba=this.color.rgba:this.rgb_display.rgb=this.color.rgb),this.kelvin_display&&(this.kelvin_display.value=this.color.kelvin),this.elem.val(this.color.hexString),this.hex_display&&(this.hex_display.value=this.color.hexString)}open(t){"none"===this.dropdown_elem.css("display")?(this.dropdown_elem.show(),i(window).on("keydown",this.on_keydown),i(window).on("mousedown",this.on_click)):this.close()}on_keydown(t){"Enter"===t.key||"Escape"===t.key?(t.preventDefault(),this.close()):"Delete"===t.key&&(t.preventDefault(),this.remove_swatch())}on_click(t){let i=this.dropdown_elem;i.is(t.target)||0!==i.has(t.target).length||this.preview_elem.is(t.target)||"block"!==i.css("display")||this.close()}close(t){t&&t.preventDefault(),this.dropdown_elem.hide(),this.elem.blur(),i(window).off("keydown",this.on_keydown),i(window).off("mousedown",this.on_click)}color_equals(t){if(t instanceof iro.Color&&t.hsla.h===this.color.hsla.h&&t.hsla.s===this.color.hsla.s&&t.hsla.l===this.color.hsla.l&&t.hsla.a===this.color.hsla.a)return!0}fix_swatches(t){if(t&&t.length){for(let i of t){let t;i instanceof Array?t={r:i[0],g:i[1],b:i[2],a:i[3]||1}:"string"==typeof i||"object"==typeof i?t=i:console.log(`ERROR: not supported color format at ${i}`),this.fixed_swatches.push(new s(this,new iro.Color(t),!0))}this.swatches_container.show()}}create_swatch(t){t&&(t.preventDefault(),this.swatches_container.show());for(let t of this.fixed_swatches)if(this.color_equals(t.color))return;for(let t of this.swatches)if(this.color_equals(t.color))return;let i=new s(this,this.picker.color.clone());this.swatches.push(i),i.select(),this.swatches.length>10-this.fixed_swatches.length&&(this.swatches[0].destroy(),this.swatches.shift()),this.set_swatches()}remove_swatch(t){if(t&&t.preventDefault(),this.active_swatch.fixed)return;this.active_swatch.destroy();let i=this.swatches.indexOf(this.active_swatch);this.swatches.splice(i,1),this.swatches.length?(this.active_swatch=this.swatches[this.swatches.length-1],this.active_swatch.select(),this.picker.color.set(this.active_swatch.color),this.set_swatches()):(this.fixed_swatches.length?(this.active_swatch=this.fixed_swatches[this.fixed_swatches.length-1],this.active_swatch.select(),this.picker.color.set(this.active_swatch.color)):this.picker.color.reset(),localStorage.removeItem(`color-swatches-${this.index}`))}set_swatches(){let t=[];for(let i of this.swatches)t.push(i.color.hsla);localStorage.setItem(`color-swatches-${this.index}`,JSON.stringify(t))}}return i((function(){void 0!==window.ts?ts.ajax.register(a.initialize,!0):a.initialize()})),t.ColorWidget=a,Object.defineProperty(t,"__esModule",{value:!0}),void 0===window.yafowil&&(window.yafowil={}),window.yafowil.color=t,t}({},jQuery);
