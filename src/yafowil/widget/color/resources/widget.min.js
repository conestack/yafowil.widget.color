!function(e,t){"use strict";class s{constructor(e,s,i){this.widget=e,this.elem=t("<div />").addClass("color-swatch").attr("id",s.substr(1)).css("background",s).appendTo(this.widget.swatches_container),this.color={hex:s,hsl:i},this.destroy=this.destroy.bind(this),this.select=this.select.bind(this),this.select(),this.elem.on("click",this.select)}find_match(e){return e.h===this.color.hsl.h&&e.s===this.color.hsl.s&&e.l===this.color.hsl.l}destroy(){this.elem.off("click",this.select),this.elem.remove()}select(e){t("div.color-swatch").removeClass("selected"),this.elem.addClass("selected"),this.widget.active_swatch=this,this.widget.hex=this.color.hex,this.widget.hsl=this.color.hsl}}class i{constructor(e,s){this.widget=e,this.elem=t("<div />").addClass("hsl-display").appendTo(e.dropdown_elem);let i=t("<div />").addClass("hue").text("H:").appendTo(this.elem),h=t("<div />").addClass("saturation").text("S:").appendTo(this.elem),l=t("<div />").addClass("lightness").text("L:").appendTo(this.elem);this.hue_input=t("<input />").addClass("h").attr({type:"number",min:0,max:360}).val(s.h).appendTo(i),this.saturation_input=t("<input />").addClass("s").attr({type:"number",min:0,max:100}).val(s.s).appendTo(h),this.lightness_input=t("<input />").addClass("l").attr({type:"number",min:0,max:100}).val(s.l).appendTo(l),this.update=this.update.bind(this),this.hue_input.add(this.saturation_input).add(this.lightness_input).on("input",this.update)}get hsl(){return{h:this.hue_input.val(),s:this.saturation_input.val(),l:this.lightness_input.val()}}set hsl(e){this.hue_input.val(e.h),this.saturation_input.val(e.s),this.lightness_input.val(e.l)}update(e){this.widget.hsl=this.hsl}}class h{constructor(e,s){this.widget=e,this.elem=t("<div />").addClass("hex-display").text("HEX:").appendTo(e.dropdown_elem),this.hex_input=t("<input />").val(s).attr({spellcheck:!1,maxlength:7}).appendTo(this.elem),this.update=this.update.bind(this),this.hex_input.on("input",this.update)}get hex(){return this.hex_input.val()}set hex(e){this.hex_input.val(e)}update(){0===this.hex.length&&this.hex_input.val("#"),this.widget.hex=this.hex}}class l{static initialize(e){t("input.color-picker",e).each((function(){new l(t(this),{hsl_display:!0,hex_display:!0})}))}constructor(e,i){this.elem=e,this.elem.data("color_widget",this).attr("spellcheck","false").attr("maxlength",7),this.dropdown_elem=t("<div />").addClass("color-picker-wrapper"),this.picker_container=t("<div />").addClass("color-picker-container").appendTo(this.dropdown_elem),this.close_btn=t("<button />").addClass("close-button").text("âœ•").appendTo(this.dropdown_elem),this.add_color_btn=t("<button />").addClass("add_color").text("+ Add"),this.remove_color_btn=t("<button />").addClass("remove_color").text("- Remove"),this.buttons=t("<div />").addClass("buttons").append(this.add_color_btn).append(this.remove_color_btn).appendTo(this.dropdown_elem),this.swatches_container=t("<div />").addClass("color-picker-recent").appendTo(this.dropdown_elem),this.picker=new iro.ColorPicker(this.picker_container.get(0),{color:this.color,layout:[{component:iro.ui.Box,options:{}},{component:iro.ui.Slider,options:{sliderType:"hue"}}]}),this.color_swatches=[],this.init_options(i);let h=localStorage.getItem("color-swatches");if(h){this.swatches_container.show();let e=JSON.parse(h);for(let t of e)this.color_swatches.push(new s(this,t.hex,t.hsl));this.active_swatch=this.color_swatches[this.color_swatches.length-1],this.active_swatch.select(),this.hex=this.active_swatch.color.hex,this.hsl=this.active_swatch.color.hsl}else this.hex="#ffffff",this.hsl={h:0,s:0,l:100};this.elem.val(this.hex),this.preview_elem.css("background",this.hex),this.resize_handle=this.resize_handle.bind(this),this.resize_handle(),t(window).on("resize",this.resize_handle),this.create_swatch=this.create_swatch.bind(this),this.add_color_btn.on("click",this.create_swatch),this.remove_swatch=this.remove_swatch.bind(this),this.remove_color_btn.on("click",this.remove_swatch),this.trigger_handle=this.trigger_handle.bind(this),this.elem.on("focus",this.trigger_handle),this.preview_elem.on("click",this.trigger_handle),this.elem.on("input",(()=>{let e=this.elem.val();0===e.length&&this.elem.val("#"),this.hex=e})),this.update_color=this.update_color.bind(this),this.picker.on("color:change",this.update_color),this.hide_elem=this.hide_elem.bind(this),this.close_btn.on("click",this.hide_elem),this.handle_keypress=this.handle_keypress.bind(this),this.handle_click=this.handle_click.bind(this)}get hex(){return this._hex}set hex(e){"string"!=typeof e||"#"!==e[0]||7!==e.length||isNaN(Number("0x"+e.substring(1,7)))||(this._hex=e,this.picker.color.hexString=e,this.elem.val(e),this.hex_display&&(this.hex_display.hex=e))}get hsl(){return this._hsl}set hsl(e){this.picker.color.hsl=e,this.hsl_display&&(this.hsl_display.hsl=e),this._hsl=e}init_options(e){e&&e.preview_elem?(this.preview_elem=e.preview_elem,this.elem.after(this.dropdown_elem)):(this.preview_elem=t("<span />").addClass("color-picker-color"),this.elem.after(this.preview_elem),this.preview_elem.after(this.dropdown_elem)),e&&e.hsl_display?this.hsl_display=new i(this,this.picker.color.hsl):this.buttons.addClass("hsl-false"),e&&e.hex_display&&(this.hex_display=new h(this,this.picker.color.hexString))}resize_handle(e){if(t(window).width()<=450){this.dropdown_elem.hasClass("mobile")||(this.dropdown_elem.addClass("mobile"),this.picker.state.layoutDirection="horizontal");let e=.3*t(window).width();this.picker.resize(e)}else t(window).width()>450&&this.dropdown_elem.hasClass("mobile")&&(this.dropdown_elem.removeClass("mobile"),this.picker.state.layoutDirection="vertical",this.picker.resize(300))}update_color(){this.hex=this.picker.color.hexString,this.hsl=this.picker.color.hsl,this.preview_elem.css("background",this.hex),this.elem.val(this.hex)}trigger_handle(e){"none"===this.dropdown_elem.css("display")?(this.dropdown_elem.show(),t(window).on("keydown",this.handle_keypress),t(window).on("mousedown",this.handle_click)):this.hide_elem()}handle_keypress(e){"Enter"===e.key||"Escape"===e.key?(e.preventDefault(),this.hide_elem()):"Delete"===e.key&&(e.preventDefault(),this.remove_swatch())}handle_click(e){let t=this.dropdown_elem;t.is(e.target)||0!==t.has(e.target).length||this.preview_elem.is(e.target)||"block"!==t.css("display")||this.hide_elem()}hide_elem(e){e&&e.preventDefault(),this.dropdown_elem.hide(),this.elem.blur(),t(window).off("keydown",this.handle_keypress),t(window).off("mousedown",this.handle_click)}create_swatch(e){e&&(e.preventDefault(),this.swatches_container.show());let t=this.picker.color.hsl,i=this.picker.color.hexString;for(let e of this.color_swatches)if(e.find_match(t))return;let h=new s(this,i,t);this.color_swatches.push(h),this.color_swatches.length>12&&(this.color_swatches[0].destroy(),this.color_swatches.shift()),this.set_swatches()}remove_swatch(e){e&&e.preventDefault(),this.active_swatch.destroy();let t=this.color_swatches.indexOf(this.active_swatch);this.color_swatches.splice(t,1);let s=this.color_swatches[this.color_swatches.length-1];if(0===this.color_swatches.length)return this.picker.color.hsl={h:0,s:0,l:100},this.hex="#ffffff",void localStorage.removeItem("color-swatches");s.select(),this.picker.color.hsl=s.color.hsl,this.hex=s.color.hex,this.set_swatches()}set_swatches(){let e=[];for(let t of this.color_swatches)e.push(t.color);localStorage.setItem("color-swatches",JSON.stringify(e))}}t((function(){void 0!==window.ts?ts.ajax.register(l.initialize,!0):l.initialize()})),e.ColorWidget=l,Object.defineProperty(e,"__esModule",{value:!0}),void 0===window.yafowil&&(window.yafowil={}),window.yafowil.color=e}({},jQuery);
//# sourceMappingURL=widget.min.js.map
